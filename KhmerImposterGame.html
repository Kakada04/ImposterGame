<!DOCTYPE html>
<html lang="en" class="h-full bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ល្បែង Imposter</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body,
        html {
            font-family: 'Kantumruy', sans-serif;
        }

        .card-mask {
            background: linear-gradient(135deg, #1e3a8a, #5b21b6);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.4) inset;
        }

        .reveal-effect {
            animation: glow 1s ease-out forwards;
        }

        @keyframes glow {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>

<body class="h-full text-white flex items-center justify-center p-4">

    <div id="app"
        class="max-w-lg w-full mx-auto bg-black bg-opacity-30 backdrop-blur-lg rounded-3xl shadow-2xl overflow-hidden border border-white border-opacity-20">

        <!-- Header -->
        <div class="text-center py-8 px-6">
            <h1 class="text-4xl font-bold mb-2">Imposter Game</h1>
            <p class="text-sm opacity-90">រក Imposter!</p>
        </div>

        <!-- Setup Screen -->
        <div id="setup" class="p-6 space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-semibold mb-2">ចំនួនអ្នកលេង</label>
                    <input type="number" id="numPlayers" min="2" max="20" value="4"
                        class="w-full px-4 py-3 rounded-xl bg-white bg-opacity-20 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-center text-lg">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2"> Imposter</label>
                    <input type="number" id="numImposters" min="1" max="2" value="1"
                        class="w-full px-4 py-3 rounded-xl bg-white bg-opacity-20 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-center text-lg">
                </div>
            </div>
            <button id="startBtn"
                class="w-full py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold rounded-2xl text-xl hover:from-yellow-300 hover:to-orange-400 transform transition hover:scale-105 shadow-lg">
                🚀 ចាប់ផ្តើមល្បែង
            </button>
        </div>

        <!-- Game Screen -->
        <div id="game" class="hidden p-6 space-y-6">
            <!-- Big Player Label -->
            <div class="text-center">
                <!-- <p class="text-xl opacity-90">កំពុងបើកតួរ</p> -->
                <p class="text-3xl font-bold text-yellow-300 mb-2">
                    <span id="currentPlayerBig">អ្នកលេងទី 1</span>
                </p>
                <p id="playerStatus" class="text-lg opacity-80">កំពុងបើក​ <span id="currentNum">1</span> / <span
                        id="totalNum">4</span></p>
            </div>

            <!-- Player Card -->
            <div
                class="relative mx-auto w-full max-w-xs aspect-square rounded-2xl overflow-hidden shadow-xl border-4 border-dashed border-yellow-300 card-mask">
                <!-- Small Label on Card -->
                <div
                    class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-bold z-10">
                    <span id="playerLabel">អ្នកលេងទី 1</span>
                </div>

                <!-- Hidden Role -->
                <div id="roleText"
                    class="absolute inset-0 flex items-center justify-center text-3xl font-bold text-yellow-200 rounded-2xl"
                    style="opacity: 0; z-index: 5;">
                </div>

                <!-- Mask Layer -->
                <div id="maskLayer" class="absolute inset-0 flex items-center justify-center rounded-2xl z-10"
                    style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.6), rgba(236, 72, 153, 0.6)), linear-gradient(135deg, #4f46e5, #ec4899); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);">
                    <span class="text-white text-4xl font-extrabold drop-shadow-lg">?</span>
                </div>

                <!-- Show Role Button -->
                <button id="showBtn"
                    class="absolute bottom-4 left-1/2 transform -translate-x-1/2 py-2 px-6 bg-green-500 rounded-xl font-bold hover:bg-green-400 transition z-20 whitespace-nowrap">
                    🔍 បង្ហាញពាក្យ
                </button>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3">
                <button id="nextBtn"
                    class="flex-1 py-3 bg-green-500 rounded-xl font-bold hover:bg-green-400 transition hidden">
                    អ្នកបន្ទាប់ →
                </button>
                <button id="showImpostersBtn"
                    class="flex-1 py-3 bg-red-600 rounded-xl font-bold hover:bg-red-500 transition hidden">
                    បង្ហាញ Imposter
                </button>
            </div>
        </div>

        <!-- Suspense Screen -->
        <div id="suspense" class="hidden p-6 text-center space-y-6">
            <h2 class="text-3xl font-bold text-yellow-400 animate-pulse">ពេលវេលាមកដល់ហើយ!</h2>
            <p class="text-xl">តើអ្នកណាជា <span class="text-red-400 font-bold"> Imposter</span>?</p>
            <button id="revealImposterBtn"
                class="w-full py-4 bg-gradient-to-r from-red-600 to-pink-600 font-bold rounded-2xl hover:from-red-500 hover:to-pink-500 transition transform hover:scale-105">
                🔎 បង្ហាញ Imposter
            </button>
        </div>

        <!-- End Screen -->
        <div id="endGame" class="hidden p-6 text-center space-y-4">
            <h2 class="text-3xl font-bold text-yellow-400"> Imposterគឺ...</h2>
            <p id="imposterList" class="text-2xl"></p>
            <button id="playAgainBtn"
                class="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 font-bold rounded-2xl hover:from-purple-400 hover:to-pink-400 transition">
                ▶️ លេងម្តងទៀត
            </button>
        </div>

    </div>
    
    <!-- Creator Credit Badge - Top Left -->
    <a href="https://portfolio-beta-ten-31.vercel.app/" target="_blank" rel="noopener noreferrer" style="
    position: fixed;
    top: 1rem;
    left: 1rem;
    z-index: 9999;
    font-family: 'Kantumruy', 'Segoe UI', sans-serif;
    font-size: 12px;
    font-weight: 500;
    color: #fefeff;
    background: linear-gradient(to bottom right, #2479e9, #3e046d);
    padding: 6px 12px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 6px;
    border: 1px solid #e5e7eb;
    transition: all 0.2s ease;
    max-width: max-content;
  " onmouseover="this.style.transform='translateY(-2px);'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)';"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 6px rgba(0,0,0,0.1)';">
        <span style="font-size: 14px;">👨‍💻</span>
        <span >Credit: kakada</span>
    </a>
    <script>
        // Khmer Words
        const khmerWords = [
            "អ្នកចម្ការ", "គ្រូបង្រៀន", "វេជ្ជបណ្ឌិត", "អ្នកឃ្លាំ", "ឆ្មា", "កូនគោ", "ទន្សាយ", "សត្វចចក", "ពស់", "ត្រី",
            "សត្វកំប្លែង", "សត្វស្វា", "សត្វទា", "សត្វបក្សា", "សត្វមាន់", "សត្វឆ្កែ", "សត្វគោ", "សត្វខ្លាឃ្មុំ", "សត្វសេក", "សត្វដំរី",
            "សត្វសិង", "សត្វហោង", "សត្វកង្កែប", "សត្វល្អិត", "សត្វរកា", "សត្វក្តាន់", "ផ្កាឈូក", "ដើមត្នោត", "ដើមចេក", "ដើមស្វាយ",
            "ដើមដូង", "ផ្កាម្កាក់", "ផ្កាមាក់", "ភ្នំ", "ទន្លេ", "សមុទ្រ", "វាលស្រែ", "វាលខ្សាច់", "អាកាស", "ព្រះអាទិត្យ",
            "ព្រះច័ន្ទ", "ផែនដី", "ភ្លើង", "ទឹក", "ខ្យល់", "ដី", "អាគារ", "ផ្ទះ", "វិហារ", "សាលារៀន", "មន្ទីរពេទ្យ", "ផ្សារ",
            "រថយន្ត", "ម៉ូតូ", "ទូក", "យន្តហោះ", "រថភ្លើង", "ទូរសព្ទ", "កុំព្យូទ័រ", "វិទ្យុ", "ទូរទស្សន៍", "សៀវភៅ",
            "ខែ", "ថ្ងៃ", "ម៉ោង", "នាទី", "វិនាទី", "ឆ្នាំ", "អាយុ", "ឈ្មោះ", "ភាសា", "អក្សរ", "ពាក្យ", "ប្រទេស",
            "រាជធានី", "ខេត្ត", "ស្រុក", "ឃុំ", "ភូមិ", "មនុស្ស", "ក្មេងប្រុស", "ក្មេងស្រី", "បុរស", "ស្ត្រី",
            "ឪពុក", "ម្តាយ", "កូន", "បង", "ប្អូន", "ប្តី", "ប្រពន្ធ", "មិត្ត", "សត្រូវ", "សិស្ស", "និស្សិត",
            "អ្នកធ្វើការ", "អ្នកចម្បាំង", "អ្នកនិពន្ធ", "អ្នកចម្រៀង", "អ្នករាំ", "អ្នកគូរ", "អ្នកថតរូប", "អ្នកចំអិន", "អ្នកលក់", "អ្នកទិញ"
        ];

        // Game State
        let gameState = {
            players: [],
            currentIdx: 0,
            usedCrewWords: new Set(),
            allWordsExhausted: false
        };

        // Elements
        const $ = id => document.getElementById(id);
        const setup = $('setup');
        const game = $('game');
        const suspense = $('suspense');
        const endGame = $('endGame');
        const startBtn = $('startBtn');
        const nextBtn = $('nextBtn');
        const showImpostersBtn = $('showImpostersBtn');
        const revealImposterBtn = $('revealImposterBtn');
        const playAgainBtn = $('playAgainBtn');
        const showBtn = $('showBtn');
        const roleText = $('roleText');
        const maskLayer = $('maskLayer');
        const playerStatus = $('playerStatus');
        const currentNum = $('currentNum');
        const totalNum = $('totalNum');
        const playerLabel = $('playerLabel');
        const currentPlayerBig = $('currentPlayerBig');
        const imposterList = $('imposterList');

        // Get unique crew word
        function getCrewWord() {
            if (gameState.usedCrewWords.size >= khmerWords.length) {
                gameState.usedCrewWords = new Set();
                gameState.allWordsExhausted = true;
            }
            const available = khmerWords.filter(w => !gameState.usedCrewWords.has(w));
            const word = available.length > 0
                ? available[Math.floor(Math.random() * available.length)]
                : khmerWords[Math.floor(Math.random() * khmerWords.length)];
            gameState.usedCrewWords.add(word);
            return word;
        }

        // Start Game
        startBtn.addEventListener('click', () => {
            const numPlayers = parseInt($('numPlayers').value);
            let numImposters = parseInt($('numImposters').value);

            if (isNaN(numPlayers) || numPlayers < 2 || numPlayers > 20) {
                alert("ចំនួនអ្នកលេងត្រូវតែពី 2 ទៅ 20");
                return;
            }
            if (numImposters < 1 || numImposters > 2 || numImposters >= numPlayers) {
                alert(" Imposterត្រូវតែ 1 ឬ 2 ហើយតិចជាងចំនួនអ្នកលេង");
                return;
            }

            // Reset
            gameState.players = [];
            gameState.currentIdx = 0;
            if (gameState.allWordsExhausted) gameState.usedCrewWords = new Set();

            const crewWord = getCrewWord();

            for (let i = 0; i < numImposters; i++) {
                gameState.players.push({ role: " Imposter" });
            }
            for (let i = 0; i < numPlayers - numImposters; i++) {
                gameState.players.push({ role: crewWord });
            }

            // Shuffle roles
            for (let i = gameState.players.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [gameState.players[i], gameState.players[j]] = [gameState.players[j], gameState.players[i]];
            }

            // Update UI
            totalNum.textContent = numPlayers;
            currentNum.textContent = 1;
            playerStatus.textContent = `កំពុងបើក​ 1 / ${numPlayers}`;
            playerLabel.textContent = `អ្នកលេងទី 1`;
            currentPlayerBig.textContent = `អ្នកលេងទី 1`;

            // Show game
            setup.classList.add('hidden');
            game.classList.remove('hidden');
            nextBtn.classList.add('hidden');
            showImpostersBtn.classList.add('hidden');
            roleText.style.opacity = 0;
            maskLayer.style.display = 'flex';
            showBtn.style.display = 'block';
        });

        // Show Role
        showBtn.addEventListener('click', () => {
            const player = gameState.players[gameState.currentIdx];
            roleText.textContent = player.role;
            roleText.classList.add('reveal-effect');
            roleText.style.opacity = 1;
            maskLayer.style.display = 'none';
            showBtn.style.display = 'none';
            nextBtn.classList.remove('hidden');
        });

        // Next Player
        nextBtn.addEventListener('click', () => {
            gameState.currentIdx++;
            if (gameState.currentIdx >= gameState.players.length) {
                game.classList.add('hidden');
                suspense.classList.remove('hidden');
            } else {
                currentNum.textContent = gameState.currentIdx + 1;
                playerStatus.textContent = `កំពុងបើក​ ${gameState.currentIdx + 1} / ${gameState.players.length}`;
                const playerNum = gameState.currentIdx + 1;
                playerLabel.textContent = `អ្នកលេង ${playerNum}`;
                currentPlayerBig.textContent = `អ្នកលេង ${playerNum}`;
                roleText.style.opacity = 0;
                roleText.classList.remove('reveal-effect');
                maskLayer.style.display = 'flex';
                showBtn.style.display = 'block';
                nextBtn.classList.add('hidden');
            }
        });

        // Reveal Imposter
        revealImposterBtn.addEventListener('click', () => {
            suspense.classList.add('hidden');
            endGame.classList.remove('hidden');
            const imposters = gameState.players
                .map((p, i) => p.role === " Imposter" ? `អ្នកលេង ${i + 1}` : null)
                .filter(Boolean)
                .join(' និង ');
            imposterList.textContent = imposters;
        });

        // Play Again
        playAgainBtn.addEventListener('click', () => {
            endGame.classList.add('hidden');
            setup.classList.remove('hidden');
        });
    </script>
</body>

</html>